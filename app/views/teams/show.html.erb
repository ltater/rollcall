<h1><%= @team.name %></h1>

<h2>Current Players</h2>
<% if @team.players.any? %>
	<ul>
		<% @team.players.each do |player| %>
			<li>
				<%= player.name %>
				<%= button_to "Remove", remove_player_team_path(@team, player_id: player.id),
					method: :post,
					data: { confirm: "Remove #{player.name} from team?" },
					style: "display: inline; margin-left: 10px;" %>
			</li>
		<% end %>
	</ul>
<% else %>
	<p>No players on this team yet.</p>
<% end %>

<h2>Add Players to Team</h2>
<% available_players = Player.where(team_id: nil) %>
<% if available_players.any? %>
	<ul>
		<% available_players.each do |player| %>
			<li>
				<%= player.name %>
				<%= button_to "Add to Team", add_player_team_path(@team, player_id: player.id),
					method: :post,
					style: "display: inline; margin-left: 10px;" %>
			</li>
		<% end %>
	</ul>
<% else %>
	<p>No available players to add. All players are assigned to teams.</p>
<% end %>

<h2>Upcoming Games</h2>
<% upcoming_games = @team.upcoming_games %>
<% if upcoming_games.any? %>
  <table style="width: 100%; border-collapse: collapse;">
    <thead>
      <tr style="background: #f0f0f0;">
        <th style="padding: 10px; text-align: left;">Date</th>
        <th style="padding: 10px; text-align: left;">Time</th>
        <th style="padding: 10px; text-align: left;">Opponent</th>
        <th style="padding: 10px; text-align: left;">Location</th>
        <th style="padding: 10px; text-align: left;">Home/Away</th>
        <th style="padding: 10px; text-align: left;">Roll Call</th>
        <th style="padding: 10px; text-align: left;">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% upcoming_games.each do |game| %>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 10px;"><%= game.date.strftime("%b %d, %Y") %></td>
          <td style="padding: 10px;"><%= game.time.strftime("%I:%M %p") %></td>
          <td style="padding: 10px;">
            <% if game.home_team_id == @team.id %>
              vs <%= game.away_team.name %>
            <% else %>
              @ <%= game.home_team.name %>
            <% end %>
          </td>
          <td style="padding: 10px;"><%= game.location %></td>
          <td style="padding: 10px;">
            <% if game.home_team_id == @team.id %>
              <strong>Home</strong>
            <% else %>
              Away
            <% end %>
          </td>
          <td style="padding: 10px;">
            <% team_rsvps = game.rsvps.joins(:player).where(players: { team_id: @team.id }) %>
            <% if team_rsvps.any? %>
              ✅ <%= team_rsvps.yes.count %> Yes
              / ❌ <%= team_rsvps.no.count %> No
              / ⏳ <%= team_rsvps.pending.count %> Pending
            <% else %>
              <em>Not sent</em>
            <% end %>
          </td>
          <td style="padding: 10px;">
            <%= button_to "Send Roll Call", send_team_roll_call_game_path(game, team_id: @team.id), 
                method: :post,
                style: "padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer;" %>
            <%= link_to "View Details", game, style: "margin-left: 10px;" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No upcoming games scheduled.</p>
<% end %>

<h2>Past Games</h2>
<% past_games = @team.games.where("date < ?", Date.today).order(date: :desc).limit(5) %>
<% if past_games.any? %>
  <ul>
    <% past_games.each do |game| %>
      <li>
        <%= game.date.strftime("%b %d, %Y") %> - 
        <% if game.home_team_id == @team.id %>
          vs <%= game.away_team.name %> (Home)
        <% else %>
          @ <%= game.home_team.name %> (Away)
        <% end %>
        - <%= game.location %>
        <%= link_to "View", game %>
      </li>
    <% end %>
  </ul>
<% else %>
  <p>No past games.</p>
<% end %>

<%= link_to "Back", teams_path %>
<%= link_to "Edit", edit_team_path(@team) %>
<%= button_to "Delete", @team, method: :delete, data: { turbo_confirm: "Are you sure?" } %>